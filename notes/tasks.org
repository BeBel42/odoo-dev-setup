#+title: Tasks

* TODO [[https://www.odoo.com/odoo/project/1251/tasks/5082687][[Employee] Database without recruitment]]
* DONE [[https://www.odoo.com/odoo/project/1251/tasks/5103739][[Employee] Version method overwrite fields]]
#+begin_src bash :results silent
../o --checkout-community saas-18.4-overridden_cron_work_phone-mlef \
     --checkout-enterprise saas-18.4 >&2
#+end_src
[[https://www.odoo.com/odoo/project.task/5079964][Autre lien de tache related]]
Y a deja eu une tache qui a fix le probleme en 18.3 que quand on changeait le num de l'entreprise, celui de l'employe etait change...
Ca fonctionne mais en 18.4, [[https://drive.google.com/file/d/1hufZwcVHU0nWbCTP7eSEY6KL0irC3qIm/view][le num de tel change encore quand on fait une operation avec une server action (update current version)]]
[[project:community/addons/hr/models/hr_employee.py::376][Where version is updated]]
[[project:community/addons/hr/models/hr_employee.py::587][Where phone is overridden]]
* DONE [[https://www.odoo.com/odoo/project/1251/tasks/4762527][[Employee] Prevent Traceback When HR Users Access Shared Employee Links]]
Branch =18.0-fix_employee_share_permission_link-mlef=
#+begin_src bash :results silent
../o --checkout-community 18.0-fix_employee_share_permission_link-mlef \
     --checkout-enterprise master >&2
#+end_src
#+begin_src bash :results silent
./o -m hr --template hr
#+end_src
uncommenting all =private_car_plate= in [[project:community/addons/hr/views/hr_employee_views.xml::20][This file]] removes the traceback
In the network console tab, get_views returns public employee profile for private window, and employee for admin window.
So why still permission error when removing private_car_plate?
** Talk with Arthur
~group_hr_manager~ and ~group_hr_user~ are the only groups that can access private employee view
Try to see in js if user is in those groups before page load, else redirect to public employee view
Dans js y a doAction() pour faire une action pour ouvrir public employee

* DONE [[https://www.odoo.com/odoo/project/1251/tasks/5106638][[hr_attendance] Extra hours smart button gives stacktrace]]
- [[project:community/addons/hr_attendance/views/hr_employee_view.xml::131][where check_in defined for list view]]
#+begin_src bash :results silent
../o --checkout-community master-fix_extra_hours_stack_trace-mlef \
     --checkout-enterprise master >&2
#+end_src

check_in seems to be defined in attendances and not allocations...
** [[project:community/addons/hr_attendance/static/src/views/extra_hours_list_view.js::30][community/addons/hr_attendance/static/src/views/extra_hours_list_view.js::30]]
shouldDisplay is true when display_extra_hours is true
check_in is in domain from searchModel

* DONE [[https://www.odoo.com/odoo/my-tasks/5026228][[hr_holidays] Add back a well-formatted "Extra Hours" section in the Time Off dashboard]]
Made from [[https://www.odoo.com/odoo/all-tasks/4774528][task 4774528]]
#+begin_src bash :results silent
../o --checkout-community master-hr_holidays_attendance-add_well_formatted_extra_hours-mlef \
     --checkout-enterprise master >&2
#+end_src
#+begin_src bash
./o -m hr_holidays_attendance --template holidays_attendance
#+end_src

Branch: =master-hr_holidays_attendance-add_well_formatted_extra_hours-mlef=

=-m hr_attendance,hr_holidays,hr_contract=

- Add the employee.total_overtime if > 0 and if overtime is not checked on Hide on Dashboard && Deduct Extra Hours is checked
  This spec has been changed when talking with bedo

** DONE extra hours does not appear on the dashboard anymore...
** DONE add tests

** DONE [[https://runbot.odoo.com/runbot/batch/2095917/build/87408979][FIX the Runbot Issues!]]
=./o -m hr_attendance,hr_holidays,hr_contract -t :TestExpiringLeaves=

** DONE Natalie's code crashes (unable to test via gui)
[[project:community/addons/hr_holidays_attendance/models/hr_employee.py::17][community/addons/hr_holidays_attendance/models/hr_employee.py::17]]
** Talk with bedo
hr_employee
pour leave types qui demandent pas allocations & qui sont coches sur "deduct extra hours", dans _get_consumed_leaves(), je dois rajouter dans var envoyee sur discord, mais False au lieu de [allocation] (False c'est l'allocation qui n'en es pas une)

=allocations_leaves_consumed[<employee>][<holiday_status>][False]=

Je dois faire le allocations_data.update({}) mais dans false

*Extra stuff to do*
Time off type > Si coche / decoche requires allocation, alors decoche / coche hide on dashboard
Idem pour deduct extra hours
- Do a computed property, stored readonly=false so that it change (and can still be changed by user) the checkbox


** Talk with bedo 2
garder changements ligne 586 dans hr employee:
#+BEGIN_SRC
leave_type_data[False]['virtual_leaves_taken'] += allocated_time
leave_type_data[False]['virtual_remaining_leaves'] -= allocated_time
if leave.state == 'validate':
    leave_type_data[False]['remaining_leaves'] -= allocated_time
    leave_type_data[False]['leaves_taken'] += allocated_time
#+END_SRC
Prendre tous les overtime_Ids de l;employee et y prendre leur duration_real
Et apres dans la get_allocation_data overriden, dans le if (pas le else) je rajoute ca sur max_Leaves, virtual_remaining_leaves and remaining_leaves


Et retirer dans la condition le =or not leave_type.requires_allocation=

* WAIT [[https://www.odoo.com/odoo/my-tasks/4985543][[L10N_BE_Payroll] Changes since previous version]]
**master**
Chatter seems to be mail_message.py
OR mail_thread.py (hr_version inherits it)
Adding =tracking=True= in a python field makes the chatter send a message each time it is modified

in 18.3, the summary changes are in [[project:enterprise/hr_contract_salary/controllers/main.py::849]]
In the same file, the function is used. But I can't find a way to get the same logging as in the picture

The diff message is in send_diff_email:
[[project:enterprise/hr_contract_salary/controllers/main.py::899]]
To get it, you have to sign a new _offer_ in the Recruitment app.
I did it with Billy Kyle

=-m l10n_be_hr_payroll,hr_contract_salary=
Xavier (xbo) connait les trucs sur les tracking values (groups specifiques + perms, etc.)

WIP on branch *master-hr_contract_salary-add_diff_message_on_employee-mlef*

** FIXME recent PRs made changes on code I am supposed to delete
[[project:enterprise/hr_contract_salary/controllers/main.py::683][enterprise/hr_contract_salary/controllers/main.py::683]]

** talk with xavier (xbo)
Try to replace [[project:enterprise/hr_contract_salary/controllers/main.py::714]]
By =employee.create_version()=
[[project:community/addons/hr/models/hr_employee.py::383]]
Vals (in theory) are the same as the one passed in old code.

After that, with the small [[https://github.com/odoo/odoo/pull/222744/files#diff-1c37517a76b393d1d30c2b03e96611643a747d12c13b086653989f4068c660b2R447-R450][pr he sent]] tracking values should take care of it. Maybe git pull to get the changes.

After that, delete the old diff message you made
* WAIT [[[https://www.odoo.com/odoo/my-tasks/5013546][Employee] Migrate all "general" data to demo data]]
General data: =community/addons/hr/data/hr_data.xml=
Demo data: =community/addons/hr/data/hr_demo.xml=
Task is awaiting for some talks. Arthur knows a bit about it. He comes back from holidays on the 13 of aug


* DONE [[https://www.odoo.com/odoo/project/1251/tasks/4784231][[Recruitment] Make the interview links expire when a candidate is refused/archived or has signed]]
#+begin_src bash :results silent
../o --checkout-community master-hr-recruitment-survey-expire-ksni \
     --checkout-enterprise master >&2
#+end_src
#+begin_src bash
./o -m hr_recruitment_survey --template interviews
#+end_src

#+RESULTS:

[[https://github.com/odoo/odoo/pull/210980][Community PR]]
[[https://runbot.odoo.com/runbot/bundle/master-hr-recruitment-survey-expire-ksni-371641][Runbot]]
/Prakash/ has given great info in the discord channel

* DONE [[https://www.odoo.com/odoo/project/1251/tasks/5048292][[Appraisal] Default employee_id on goal creation]]
#+begin_src bash :results silent
../o --checkout-community saas-18.2 \
     --checkout-enterprise saas-18.2-default_employee_id_on_goal_creation-mlef >&2
#+end_src
[[https://github.com/odoo/enterprise/pull/93522][pr]]
=-m hr_appraisal=
Version *saas-18.2*
Branch: =saas-18.2-default_employee_id_on_goal_creation-mlef=
Put on context when clicking on "Goals" from employee the employee id, if directly click on "Goals" then leave the employee field empty.
[[project:enterprise/hr_appraisal/views/hr_appraisal_views.xml::27][Goals smart button]]
[[project:enterprise/hr_appraisal/models/hr_appraisal.py::536][Context passed to action]]

* CANCEL [[https://www.odoo.com/odoo/my-tasks/4980966][[l10n_in_Payroll] Fix the basic rule calculation condition in the Python code]]
+18.0+ *master*
=master-l10n_in_hr_payroll-minimum_wage_check-mlef=
PR:
https://github.com/odoo/enterprise/pull/35602

File:
l10n_in_hr_payroll/data/hr_rule_parameters_data.xml

Hint:
https://github.com/odoo/enterprise/pull/35602#discussion_r1119774480

Rule (Basic Salary, India: Regular Pay):
=result = max(payslip._rule_parameter('l10n_in_basic_value'), payslip.paid_amount * payslip._rule_parameter('l10n_in_basic_percent') * payslip._rule_parameter('l10n_in_basic_days'))=
Since payslip.paid_amout is 0, it thus does =max(700, 0)=

- empecher MONTHLY wage to be under the value
- et retirer max dans rule
- wage_hourly = hourly wage
- wage = monthly wage
- on master and not 18.0

** [X]
should I continue with what I was doing? Like the check, migration, etc.?
If so, the hourly_wage needs to be converted to a monthly wage to be checked against l10n_in_basic_value (?)
-> Update: it has been CANCELLED

** Talk with David PO
***  Should ask suga for minimum wage (the monthly, the hourly and the fixed one) and use those values instead
***  The constraint will have to be applied to all wage types. Not just monthly
***  Do not add case at right of payroll tab
***  Remove "From l10n_basic_value" from ui error message
***  The test will have to be changed accordingly
***  Migrate it all to 19.0 (19.1?)

* DONE [[https://www.odoo.com/odoo/my-tasks/5042323][[Payroll] Work entries]]
=-m hr_payroll=
The code that check if the work entry is not validated before deletion can be found at:
- [[project:community/addons/hr_work_entry/static/src/views/work_entry_calendar/work_entry_calendar_controller.js::151]] (for work entries view from employees)
  - [[project:enterprise/hr_work_entry_enterprise/static/src/work_entries_gantt_renderer.js::272]] (for work entries view from payroll)

* CANCEL [[https://www.odoo.com/odoo/my-tasks/4774528][[Attendance] Support Tolerance-Based Extra Hours Calculation Without Active Contract]]
=-m hr_attendance,hr_holidays,hr_contract=
=community/addons/hr_holidays/static/src/dashboard/time_off_card.xml= pour le format mauvais du time off dashboard
** Review SUGA - May 12, 2025:
38:00 / week = 7:36 hours a day
So 10:00 = 10:00 - 7:36 = 2:24 hours of overtime

On a 40h / week contract, extra hours seems legit
*DO NOT* drop the DB! I have done tests.

*The contract does not change anything.*
It's just the *working hours* under _Employee/WorkInfo/Schedule/Working Hours_

* DONE [[https://www.odoo.com/odoo/my-tasks/4901052][[Salary Config] Allow fields of salary config to be archived]]
**master**
archiver = mettre: active = fields.boolean(default=false) dans model
clean db = remove the fields you don't like (not a real dropdb _at all_)
-i hr_contract_salary




* CANCEL [[https://www.odoo.com/odoo/project/1251/tasks/4879294][[Payroll] When selecting employees from payrun, remove launch plan]]
* Configuration
#+name: Count number of tasks
#+begin_src elisp :results none
(save-excursion
  (goto-char (point-min))
  (let ((counts (make-hash-table :test 'equal)))
    (while (re-search-forward "^\\* \\([^[:space:]]+\\)" nil t)
      (let ((word (match-string 1)))
        (unless (string= word "Configuration")
          (puthash "Total" (1+ (or (gethash "Total" counts 0) 0)) counts)
          (puthash word (1+ (or (gethash word counts 0) 0)) counts)
		  )))
    (message (mapconcat
              (lambda (pair)
                (format "%s: %d" (car pair) (cdr pair)))
              (loop for k being the hash-keys of counts
                    using (hash-value v)
                    collect (cons k v))
              "\n")
             )))
#+END_src

# Local Variables:
# eval: (org-overview)
# End:
